name: termite
base: core18
version: '0.15.3-54'
summary: VTE-based terminal
description: |
  A keyboard-centric VTE-based terminal, aimed at use within a window manager
  with tiling and/or tabbing support.

# icon: termite.png

grade: stable
confinement: strict

environment:
  SHELL: bash
  #
  LC_ALL: C.UTF-8

  # --- Prep EGL ---
  __EGL_VENDOR_LIBRARY_DIRS: $SNAP/etc/glvnd/egl_vendor.d:$SNAP/usr/share/glvnd/egl_vendor.d
  # LIBGL_DRIVERS_PATH: ${SNAP}/usr/lib/${SNAPCRAFT_ARCH_TRIPLET}/dri
  LIBVA_DRIVERS_PATH: ${SNAP}/usr/lib/${SNAPCRAFT_ARCH_TRIPLET}/dri

  # --- Prep GDK ---
  GDK_BACKEND: wayland
  CLUTTER_BACKEND: wayland


apps:
  termite:
    command: usr/bin/termite
    desktop: usr/share/applications/termite.desktop
    extensions:
      - gnome-3-28


plugs:
  desktop:
  desktop-legacy:
  wayland:    
  x11:
  hardware-observe:
  home:
  gpg-keys:
  gpg-public-keys:
  mount-observe:
  log-observe:
  ssh-keys:
  system-observe:
  gpg-keys:
  gsettings:


build-packages:
  - cmake
  - quilt
  - pkgconf


parts:
  addons: # FIXME: move/mount this to/from outside
    plugin: nil
    stage-packages:
      - ssh
      - byobu
    stage:
      - -usr/share/doc
      - -usr/share/man


  fribidi:
    plugin: meson
    source: https://github.com/fribidi/fribidi.git
    source-tag: v1.0.7
    meson-parameters: 
      - --prefix=/usr
      - -Ddocs=false
    stage:
      - -usr/share/doc
      - -usr/share/man


  vte-ng:
    after: [ fribidi ]
    plugin: meson
    source: https://github.com/sd-hd/vte-ng.git
    source-tag: 0.58.2-ng
    meson-parameters: 
      - --prefix=/usr
      - -Ddocs=false
    build-packages:
      - libgirepository1.0-dev
      # - gir1.2-vte-2.91
      # - libfribidi-dev
      - libglib2.0-dev
      - libgnutls28-dev
      - libgtk-3-dev
      - libpango1.0-dev
      - libpcre2-dev
      #- libvte-2.91-0
      #- libvte-2.91-common
      - libxml2-utils
      - zlib1g-dev
    stage-packages:
      #- libvte-2.91-common
      - libatk1.0-0
      - libcairo2
      # - libfribidi0
      - libglib2.0-0
      - libgnutls30
      - libgtk-3-0
      - libpango-1.0-0
      - libpangocairo-1.0-0
      - libpcre2-8-0
      # - zlib1g
    stage:
      - -usr/share/doc
      - -usr/share/man


  termite:
    after: [ vte-ng ]
    plugin: make
    source: https://github.com/sd-hd/termite.git
    source-tag: 'v15.3'
    source-type: git
    build-packages:
      - gnutls-bin
      - gperf
      - gtk-doc-tools
      - intltool
      - libtool
      - libdconf-dev
      - libgirepository1.0-dev
      - libglib2.0-dev
      - libglib3.0-cil-dev
      - libgnutls28-dev
      - libgtk-3-dev
      - libpcre2-dev
      - libx11-dev
      - libxml2-utils
      - libsm-dev
      - uuid-dev
      - valac
    stage-packages:
      - libatk1.0-0
      - libgirepository-1.0-1
      - libglib3.0-cil
      - libgtk-3-0
      - libpango-1.0-0
      - libcairo2
      - libuuid1
      - libx11-6
      - libgdk-pixbuf2.0-0
      #- libpcre2
    organize:
      config: etc/xdg/termite/config
